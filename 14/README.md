# 가상 메모리
## 연속 메모리 할당
프로세스에 연속적인 메모리 공간을 할당하는 방식

### 스와핑swapping
대기 상태가 된 프로세스나 오랫동안 사용되지 않은 프로세스들을 임시로 보조기억장치 일부 영역으로 쫓아내고, 그렇게 해서 생긴 메모리상의 빈 공간에 또 다른 프로세스를 적재하여 실행하는 방식
- 스왑 영역: 프로세스들이 쫓겨나는 보조기억장치의 일부 영역
- 스왑 아웃: 현재 실행되지 않는 프로세스가 메모리에서 스왑 영역으로 옮겨지는 것
- 스왑 인: 스왑 영역에 있던 프로세스가 다시 메모리로 옮겨오는 것

스압 아웃되었던 프로세스가 다시 스왑 인될 때는 스왑 아웃되기 전의 물리 주소와는 다른 주소에 적재될 수 있음

### 메모리 할당
#### 최초 적합first fit
운영체제가 메모리 내의 빈 공간을 순서대로 검색하다가 적재할 수 있는 공간을 발견하면 그 공간에 프로세스를 배치하는 방식
#### 최적 적합best fit
운영체제가 빈 공간을 모두 검색해 본 후, 프로세스가 적재될 수 있는 공간 중 가장 작은 공간에 프로세스를 배치하는 방식
#### 최악 적합worst fit
운영체제가 빈 공간을 모두 검색해본 후, 프로세스가 적재될 수 있는 공간 중 가장 큰 공간에 프로세스를 배치하는 방식

### 외부 단편화external fragmentation
프로세스들이 메모리에 연속적으로 할당되는 환경에서 프로세스들이 실행되고 종료되기를 반복하며 메모리 사이 사이에 빈 공간들이 생김

빈 공간보다 큰 프로세스를 적재하기 어려운 상황을 초래하므로 메모리 낭비로 이어지는 외부 단편화

즉, 프로세스를 할당하기 어려울 만큼 작은 메모리 공간들로 인해 메모리가 낭비되는 현상

- 압축

여기저기 흩어져 있는 빈 공간들을 하나로 모으는 방식

작은 빈 공간들을 하나로 모으는 동안 시스템은 하던 일을 중지해야 하고, 메모리에 있는 내용을 옮기는 작업은 많은 오버헤드를 야기하며, 어떤 프로세스를 어떻게 움직여야 오버헤드를 최소화하며 압축할 수 있는지에 대한 명확한 방법을 결정하기 어려움

## 페이징을 통한 가상 메모리 관리
가상 메모리virtual memory: 실행하고자 하는 프로그램을 일부만 메모리에 적재하여 실제 물리 메모리 크기보다 더 큰 프로세스를 실행할 수 있게 하는 기술

### 페이징이란
프로세스의 논리 주소 공간을 페이지라는 일정한 단위로 자르고, 메모리 물리 주소 공간을 프레임이라는 페이지와 동일한 크기의 일정한 단위로 자른 뒤 페이지를 프레임에 할당하는 가상 메모리 관리 기법

메모리에 불연속적으로 할당

메모리에 적재될 필요가 없는 페이지들은 보조기억장치로 스왑 아웃되고, 실행에 필요한 페이지들은 메모리로 스왑 인되며, 페이징 시스템에서의 스압 아웃은 페이지 아웃, 스왑 인은 페이지 인이라고 부름

### 페이지 테이블
페이징 시스템은 프로세스가 물리 주소에 불연속적으로 배치되더라도 논리 주소에는 연속적으로 배치되도록 페이지 테이블을 이용

프로세스마다 각자의 프로세스 테이블을 가지고 있고 각 프로세스의 페이지 테이블들은 메모리에 적재되어 있으며, CPU 내의 페이지 테이블 베이스 레지스터PTBR; Page Table Base Register는 각 프로세스의 페이지 테이블이 적재도니 주소를 가리킴

페이지 테이블에 접근, 프레임에 접근하며 메모리 접근 시간이 늘어나기 때문에 CPU 곁에 TLB(Translation Lookaside Buffer)라는 페이지 테이블의 캐시 메모리를 두어 참조 지역성에 근거해 최근에 사용된 페이지 위주로 가져와 저장

- CPU가 발생한 논리 주소에 대한 페이지 번호가 TLB에 있을 경우 TLB hit
- TLB에 없어 페이지가 적재된 프레임을 알기 위해 메모리 내의 페이지 테이블에 접근하는 경우 TLB miss

### 페이징에서의 주소 변환

## 페이지 교체와 프레임 할당
### 요구 페이징
프로세스를 메모리에 적재할 때 처음부터 모든 페이지를 적재하지 않고 필요하나 페이지만을 메모리에 적재하는 기법

- CPU가 특정 페이지에 접근하는 명령어를 실행한다.
- 해당 페이지가 현재 메모리에 있을 경우 (유효 비트가 1일 경우) CPU는 페이지가 적재된 프레임에 접근한다.
- 해당 페이지가 현재 메모리에 없을 경우 (유효 비트가 0일 경우) 페이지 폴트가 발생한다.
- 페이지 폴트 처리 루틴은 해당 페이지를 메모리로 적재하고 유효 비트를 1로 설정한다.
- 다시 CPU가 특정 페이지에 접근하는 명령어를 실행한다.

#### 순수 요구 페이징 기법
아무런 페이지도 메모리에 적재하지 않은 채 무작정 실행하여, 프로세스의 첫 명령어를 실행하는 순간부터 페이지 폴트가 발생하고, 실행에 필요한 페이지가 어느 정도 적재된 이후부터는 페이지 폴트 발생 빈도가 떨어짐

### 페이지 교체 알고리즘
메모리에 적재된 페이지를 가져오는 것보다 보조기억장치로부터 필요한 페이지를 가져오는 것이 느리기 때문에 페이지 폴트가 적게 일어날수록 좋은 알고리즘

#### FIFO 페이지 교체 알고리즘 First-In First-Out Page Replacement Algorithm
#### 최적 페이지 교체 알고리즘
CPU에 의해 참조되는 횟수를 고려하는 페이지 교체 알고리즘
#### LRU 페이지 교체 알고리즘 Least Recently Used Page Replacement Algorithm
가장 오랫동안 사용되지 않은 페이지를 교체하는 알고리즘

### 스래싱과 프레임 할당
프로세스가 사용할 수 있는 프레임 수가 적어도 페이지 폴트 발생

스래싱thrashing: 프로세스가 실제 실행되는 시간보다 페이징에 더 많은 시간을 소요하여 성능이 저해되는 문제
